# Архитектура приложения "Трекер Привычек"

## Общее описание

Мини-приложение для Telegram, позволяющее пользователям отслеживать свои привычки индивидуально или совместно с друзьями.

## Технологический стек

### Frontend
- **React 18** - UI библиотека
- **TypeScript** - типизация
- **Vite** - сборщик и dev-сервер
- **React Router** - маршрутизация
- **Axios** - HTTP клиент

### Backend
- **FastAPI** - веб-фреймворк
- **SQLAlchemy** - ORM
- **PostgreSQL** - база данных
- **Pydantic** - валидация данных
- **Uvicorn** - ASGI сервер

## Архитектура базы данных

### Основные таблицы

#### users
Хранит информацию о пользователях Telegram
- `telegram_id` - уникальный ID из Telegram
- `avatar_emoji` - эмодзи для аватара
- `bio` - описание профиля

#### habits
Привычки пользователей
- `is_shared` - флаг совместной привычки
- `frequency` - частота выполнения (daily/weekly)
- `created_by` - создатель привычки

#### habit_participants
Связь многие-ко-многим между привычками и пользователями
- Позволяет нескольким пользователям участвовать в одной привычке

#### habit_logs
Записи о выполнении привычек
- Уникальный индекс на (habit_id, user_id, DATE(completed_at))
- Предотвращает дублирование выполнений в один день

#### friendships
Дружеские связи между пользователями
- Статусы: pending, accepted, blocked
- Проверка на самодружбу

#### habit_notifications
Настройки уведомлений для привычек
- Время напоминания
- Дни недели для уведомлений

## API Структура

### Авторизация
Используется автоматическая авторизация через Telegram Web App:
- Данные пользователя передаются в заголовке `X-Telegram-Init-Data`
- Backend верифицирует данные и создает/находит пользователя

### Основные эндпоинты

#### `/api/auth/me`
Получение информации о текущем пользователе

#### `/api/habits`
- `GET` - список привычек пользователя
- `POST` - создание новой привычки

#### `/api/habits/{id}`
- `GET` - детали привычки
- `PUT` - обновление привычки
- `DELETE` - удаление привычки

#### `/api/habits/{id}/complete`
- `POST` - отметка выполнения привычки

#### `/api/friends`
- `GET` - список друзей
- `POST /{user_id}` - добавить друга
- `DELETE /{user_id}` - удалить друга

#### `/api/stats/habits/{id}`
- `GET` - статистика по привычке

#### `/api/profile`
- `GET` - получить профиль
- `PUT` - обновить профиль

## Frontend Структура

### Компоненты
- `Layout` - основной layout с нижним меню
- `BottomMenu` - навигационное меню
- `HabitCard` - карточка привычки
- `HabitForm` - форма создания/редактирования привычки

### Страницы
- `HomePage` - главная страница со списком привычек
- `HabitsPage` - управление привычками
- `HabitDetailPage` - детали привычки и статистика
- `FriendsPage` - список друзей
- `ProfilePage` - профиль пользователя

### Стили
- Glassmorphism дизайн с полупрозрачными блоками
- Адаптивная верстка для мобильных устройств
- CSS переменные для легкой настройки темы

## Безопасность

1. **Верификация Telegram данных** - проверка подлинности данных от Telegram
2. **Авторизация на каждом запросе** - проверка прав доступа
3. **Валидация данных** - Pydantic схемы для всех входных данных
4. **SQL инъекции** - защита через SQLAlchemy ORM
5. **CORS** - настройка разрешенных источников

## Производительность

### Оптимизации БД
- Индексы на часто используемых полях
- Уникальные индексы для предотвращения дубликатов
- Каскадное удаление для связанных записей

### Backend
- Connection pooling для БД
- Асинхронные запросы через FastAPI
- Кэширование (можно добавить Redis в будущем)

### Frontend
- Code splitting через React Router
- Ленивая загрузка компонентов
- Оптимизация изображений и ресурсов

## Масштабируемость

### Текущая архитектура
- Монолитное приложение
- Одна БД PostgreSQL
- Подходит для средних нагрузок (до 10k пользователей)

### Будущие улучшения
- Микросервисная архитектура (при необходимости)
- Redis для кэширования и сессий
- Очереди задач для уведомлений (Celery + RabbitMQ)
- CDN для статических файлов
- Горизонтальное масштабирование через load balancer

## Развертывание

### Development
- Локальный запуск через Vite и Uvicorn
- Hot reload для быстрой разработки

### Production
- Frontend: сборка через `npm run build`, раздача через Nginx
- Backend: запуск через Gunicorn/Uvicorn с несколькими воркерами
- БД: PostgreSQL с репликацией для высокой доступности
- Мониторинг: логирование, метрики, алерты

